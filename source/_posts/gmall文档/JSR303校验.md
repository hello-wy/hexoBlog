title: JSR303校验
author: 远方
tags:
  - LeetCode
  - 算法
categories:
  - LeetCode破局攻略
date: 2016-01-01 19:20:00
---
# 简介

后端开启校验在实体类中使用注解@NotNull、@NotBlank之类的这些类都在javax.validation.constraints包下

访问方法:双击shift进行搜索方法.



所有的校验注解在validationMessages_zh_cn.peoperties这个是中文注解



然后在controller对应的entity传参数中添加`@valid`开启校验功能。

# @valid和@validation区别

@valid是一个标准没有分组功能，@validation具有分组功能。



# 使用步骤

1. 引入springboot-starter-validation包
2. 给bean字段添加验证注解
3. 开启校验`@valid`或者`@validated`,开启之后会有一个默认的响应
4. 通过一个统一的异常处理类进行捕获所有验证异常的异常。使用@controllerAdvice
5. 分组校验使用`@validated`(必须使用)在controller传参数之前。



## 统一的异常处理  @controllerAdvice+@exceptHandler

通过抽取异常处理,进行统一的管理.

### 针对特定的错误进行集中处理

```java
@Slf4j
@RestControllerAdvice(basePackages = "com.bigdata.gulimall.product.controller")
public class GulimallExceptionAdvice {

    @ExceptionHandler(value = MethodArgumentNotValidException.class)
    public R handleValidException(MethodArgumentNotValidException exception){
        Map<String,String> map=new HashMap<>();
        BindingResult bindingResult = exception.getBindingResult();
        bindingResult.getFieldErrors().forEach(fieldError -> {
            String message = fieldError.getDefaultMessage();
            String field = fieldError.getField();
            map.put(field,message);
        });

        log.error("数据校验出现问题{},异常类型{}",exception.getMessage(),exception.getClass());
        return R.error(400,"数据校验出现问题").put("data",map);
    }

}

```

上面的代码,通过exceptionhandler设置value值进行对参数格式不合法，进行统一的管理.

### 默认统一处理异常(未知的)

```java
   @ExceptionHandler(value = Throwable.class)
    public R handleException(Throwable throwable){
        log.error("未知异常{},异常类型{}",throwable.getMessage(),throwable.getClass());
        return R.error(BizCodeEnum.UNKNOW_EXEPTION.getCode(),BizCodeEnum.UNKNOW_EXEPTION.getMsg());
    }
```

直接截断throwable异常，

## 系统错误码（枚举类）

使用统一的管理错误码的类。对错误码以及错误提示进行统一的管理。

```java
public enum BizCodeEnum {

   
    UNKNOW_EXEPTION(10000,"系统未知异常"),

    VALID_EXCEPTION( 10001,"参数格式校验失败");

    private int code;
    private String msg;

    BizCodeEnum(int code, String msg) {
        this.code = code;
        this.msg = msg;
    }

    public int getCode() {
        return code;
    }

    public String getMsg() {
        return msg;
    }
}
```



# 分组校验(可以使用多个VO进行代替解决)

不同的场景使用不同的校验，比如说添加时，和插入时这个是不同的。

使用groups

使用@valid


